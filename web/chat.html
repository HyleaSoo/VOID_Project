<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>JavaScript:;</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="D:\Pro\code\json.css" rel="stylesheet">
    <script src="D:\Pro\code\dium.js"></script>
    <script>
        const host = 'http://127.0.0.1:5555/v1/';
        // if (!localStorage.getItem('token')) {
        //     post(`${host}user/login`, {account:'test1', password:'111111'}).then(r => {
        //         localStorage.setItem('userId', r.userId);
        //         localStorage.setItem('token', r.tokens);
        //     });
        // }

        const get = async url => {
            let res;
            await fetch(url, {
                headers: {
                    'userId': localStorage.getItem('userId'),
                    'token': localStorage.getItem('token')
                }
            }).then(r => r.json()).then(r => res = r);
            return res;
        }
        const post = async (url, data) => {
            let res;
            await fetch(url, {
                method: 'POST',
                headers: {
                    'userId': localStorage.getItem('userId'),
                    'token': localStorage.getItem('token'),
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            }).then(r => r.json()).then(r => res = r);
            return res;
        }
        const convertObj = data => {
            var _result = [];
            for (var key in data) {
                var value = data[key];
                if (value.constructor == Array) {
                    value.forEach(function(_value) {
                        _result.push(key + "=" + _value);
                    });
                } else {
                    _result.push(key + '=' + value);
                }
            }
            return `?${_result.join('&')}`;
        }
        /* window.onload = _ => {
            post().then(r => {
                document.body.append(renderJson(r));
            });
            get(`${host}user/login`).then(r => {
                document.body.append(renderJson(r));
            });
        } */
        /* window.onload = _ => {
            fetch(`${host}user/login`).then(r => r.json()).then(r => document.body.append(renderJson(r)));
        } */
    </script>
    <script>
        /* const url = 'http://127.0.0.1:5555/v1/mhr/location/';
        get(url).then(r => document.body.append(renderJson(r))); */
    </script>
    <script>
        window.onload = _ => {
            fetch(`${host}user/file`).then(r => r.blob()).then(r => {
                const url = URL.createObjectURL(new Blob([r], {type: 'application/xlsx'}));
console.log(url);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'abc.xlsx';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                // document.body.append(renderJson(r))
            });
        }
    </script>
</head>

<body class="body">
</body>

</html>